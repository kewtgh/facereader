{% assign related_posts = "" | split: "" %}

{% for post in site.posts %}
  {% if post.id == page.id %}
    {% continue %}
  {% endif %}

  {% assign tag_matches = post.tags | intersection: page.tags | size %}
  {% assign cat_matches = post.categories | intersection: page.categories | size %}
  {% assign score = tag_matches | plus: cat_matches %}

  {% if score > 0 %}
    {% assign related_posts = related_posts | push: post %}
  {% endif %}
{% endfor %}

{% if related_posts.size < 4 %}
  {% for post in site.posts %}
    {% if post.id == page.id %}
      {% continue %}
    {% endif %}
    {% unless related_posts contains post %}
      {% assign related_posts = related_posts | push: post %}
    {% endunless %}
  {% endfor %}
{% endif %}

<div class="page__related">
  <h2 class="page__related-title">相关推荐</h2>
  <div class="grid__wrapper">
    {% for post in related_posts limit:4 %}
      {% include archive-single.html type="grid" %}
    {% endfor %}
  </div>
</div>
